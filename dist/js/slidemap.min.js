/*!
 * Slidemap jQuery plug-in v.0.1.0
 *
 * https://github.com/jaumesala/slidemap
 *
 * Authored by Jaume Sala
 * http://jaumesala.net
 *
 * Copyright 2015, Jaume Sala
 * License: MIT License (MIT)
 * http://opensource.org/licenses/MIT
 *
 */
!function(t){"use strict";t.fn.slideMap=function(a){var s={debug:!1,units:"px",showShadow:!0,useMaskShadow:!0,shadow:'<div class="slmp-shadow"><span class="slmp-s t"></span><span class="slmp-s b"></span><span class="slmp-s l"></span><span class="slmp-s r"></span></div>',mask:'<img class="slmp-thumbnail-mask">',grid:'<div class="slmp-grid"></div>',offsetX:0,offsetY:0,showControls:!1,controls:'<div class="slmp-controls"><a data-action="prev" class="slmp-btn slmp-btn-prev" href="#">←</a><a data-action="play-pause" class="slmp-btn slmp-btn-play-pause" href="#"><span class="play">►</span><span class="pause">■</span></a><a data-action="next" class="slmp-btn slmp-btn-next" href="#">→</a></div>',animSpeed:4e3,automatic:!1,onMoveToArea:function(){},onAreaClicked:function(){},onControlNext:function(){},onControlPrev:function(){},onControlPlay:function(){},onControlPause:function(){}},e=t.extend({},s,a),n=this,i=n.find(".slmp-slide"),r=i.find(".slmp-image"),o={image:{natural:{},scaled:{}},map:{}},l=i.find(".slmp-caption"),p=n.find(".slmp-map"),h={},c=p.find(".slmp-area"),d=p.find(".slmp-thumbnail"),f=t(e.mask),u={},m=void 0,g=function(){v(),P(),e.showControls&&X()},w=function(t,a){if(e.debug)switch(t){case"start":console.group(a);break;case"stop":"undefined"!=typeof a&&console.log(a),console.groupEnd();break;default:console.log(t)}},v=function(){x(),e.showShadow&&M()},x=function(){c.each(function(){var a=b(this);t(this).css({left:a[0]+e.units,top:a[1]+e.units,width:a[2]+e.units,height:a[3]+e.units})}),p.on("click",".slmp-area",function(t){t.preventDefault(),e.onAreaClicked.call(this),C(this),Y(!1)})},C=function(a){I(a);var s=b(a);e.showShadow&&k(s),A(s),T(c.index(t(a)))},b=function(a){return t(a).data("coords").split(",")},y=function(){var t=c.filter(".active").first();return t.length>0?t:void 0},I=function(a){c.not(t(a)).removeClass("active"),t(a).addClass("active")},M=function(){e.useMaskShadow?(f.attr("src",d.attr("src")),d.after(f)):(h.wrapper=t(e.shadow),h.sTop=h.wrapper.find(".slmp-s.t"),h.sBottom=h.wrapper.find(".slmp-s.b"),h.sLeft=h.wrapper.find(".slmp-s.l"),h.sRight=h.wrapper.find(".slmp-s.r"),p.prepend(h.wrapper));var a=y();a&&k(b(a))},k=function(t){if(e.useMaskShadow){var a=parseInt(t[1]),s=parseInt(t[0])+parseInt(t[2]),n=parseInt(t[1])+parseInt(t[3]),i=parseInt(t[0]);f.css("clip","rect("+a+"px, "+s+"px, "+n+"px, "+i+"px)")}else h.sTop.css({left:t[0]+e.units,width:t[2]+e.units,height:t[1]+e.units}),h.sBottom.css({left:t[0]+e.units,width:t[2]+e.units,height:p.height()-t[1]-t[3]+e.units}),h.sLeft.css({width:t[0]+e.units}),h.sRight.css({width:p.width()-t[0]-t[2]+e.units})},P=function(){S(),N()},S=function(){w("start","initImage"),r.one("load",function(){o.width=i.width(),o.height=i.height(),o.image.natural.width=r.width(),o.image.natural.height=r.height(),o.image.scaled.width=o.height*o.image.natural.width/o.image.natural.height,o.image.scaled.height=o.height,o.map.width=p.width(),o.map.height=p.height(),w("Get slide and image properties:"),w(o),r.css({width:"auto",height:o.image.scaled.height});var t=y();t&&A(b(t))}).each(function(){this.complete&&t(this).load()}),w("stop")},A=function(t){w("start","moveImage"),w("coordsArea"),w(t);var a=[Math.round(o.image.scaled.width*t[0]/o.map.width),Math.round(o.image.scaled.height*t[1]/o.map.height),Math.round(o.image.scaled.width*t[2]/o.map.width),Math.round(o.image.scaled.height*t[3]/o.map.height),Math.round(t[4])];w("coordsTarget"),w(a),e.onMoveToArea.call(r,t,a);var s=-Math.abs(a[0]),n=-Math.abs(a[1]),i=0,l=a[2]>o.width?!0:!1,p=a[3]>o.height?!0:!1;if(l||p)if(l&&!p)w("Overflow: H"),s+=e.offsetX-(a[2]-o.width)/2,n+=e.offsetY+(o.height-a[3])/2,i+=-Math.abs(a[4]-(a[2]-o.width));else if(!l&&p)w("Overflow: V"),s+=e.offsetX+(o.width-a[2])/2,n+=e.offsetY+(a[3]-o.height)/2,i+=-Math.abs(a[4]-(a[3]-o.height));else{w("Overflow: H V"),s+=e.offsetX-(a[2]-o.width)/2,n+=e.offsetY+(a[3]-o.height)/2;var h=-Math.abs(a[4]-(a[2]-o.width)),c=-Math.abs(a[4]-(a[3]-o.height));i+=Math.min(h,c)}else w("Overflow: No"),s+=e.offsetX+(o.width-a[2])/2,n+=e.offsetY+(o.height-a[3])/2,i+=a[4];s+=e.units,n+=e.units,i+=e.units,r.css({transform:"translate3d("+s+","+n+", "+i+")"}),w("stop")},N=function(){var t=y();t&&T(t.index(c))},T=function(t){l.removeClass("active"),l.eq(t).addClass("active")},X=function(){u.wrapper=t(e.controls),u.cPlayPause=u.wrapper.find(".slmp-btn-play-pause"),u.cNext=u.wrapper.find(".slmp-btn-next"),u.cPrev=u.wrapper.find(".slmp-btn-prev"),p.after(u.wrapper),u.wrapper.addClass("pause"),u.wrapper.on("click",".slmp-btn",function(a){a.preventDefault();var s=t(this).attr("data-action");if("next"===s){w("Control Next clicked");var n=y();e.onControlNext.call(),Y(!1),C(n.next(".slmp-area").length?n.next(".slmp-area"):c.first())}if("prev"===s){w("Control Prev clicked");var n=y();e.onControlPrev.call(),Y(!1),C(n.prev(".slmp-area").length?n.prev(".slmp-area"):c.last())}"play-pause"===s&&(w("Control playPause clicked"),u.wrapper.hasClass("play")?(e.onControlPause.call(),Y(!1)):(e.onControlPlay.call(),Y(!0)))}),e.automatic&&Y(!0)},Y=function(t){t?(e.showControls&&u.wrapper.addClass("play").removeClass("pause"),m=setInterval(function(){var t=y();C(t.next(".slmp-area").length?t.next(".slmp-area"):c.first())},e.animSpeed)):(e.showControls&&u.wrapper.addClass("pause").removeClass("play"),clearInterval(m))};g()},t.fx.step.clip=function(a){if(console.log(a),0===a.pos){var s=/rect\(([0-9\.]{1,})(px|em)[,]?\s+([0-9\.]{1,})(px|em)[,]?\s+([0-9\.]{1,})(px|em)[,]?\s+([0-9\.]{1,})(px|em)\)/,e=(t(a.elem).css("clip")||"").replace(/,/g," ");a.start=s.exec(e),"string"==typeof a.end&&(a.end=s.exec(a.end.replace(/,/g," ")))}if(a.start&&a.end){for(var n=new Array,i=new Array,r=a.start.length,o=a.end.length,l="em"==a.start[p+1]?1.333*parseInt(t(a.elem).css("fontSize"))*parseInt(a.start[p]):1,p=1;r>p;p+=2)n.push(parseInt(l*a.start[p]));for(var h=1;o>h;h+=2)i.push(parseInt(l*a.end[h]));a.elem.style.clip="rect("+parseInt(a.pos*(i[0]-n[0])+n[0])+"px "+parseInt(a.pos*(i[1]-n[1])+n[1])+"px "+parseInt(a.pos*(i[2]-n[2])+n[2])+"px "+parseInt(a.pos*(i[3]-n[3])+n[3])+"px)"}}}(jQuery);